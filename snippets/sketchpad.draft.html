<style>
  .pad {
    /* use cssgrid to make all the divs inside fill the screen evenly */
  }
  .pixel {
    /* make each pixel fill it's 1%/1% area */
  }
</style>

<div id="sketchpad" class="pad"></div>

<script>
  class Board {
    height = 0;
    width = 0;
    thing = null;
    things = [];
    startTime = 0;

    constructor(thing, height, width) {
      this.height = height;
      this.width = width;
      this.thing = thing;
      this.populate();
      this.startTime = Date.now();
    }

    populate() {
      const Thing = this.thing;
      for (let i = 0; i < this.height; i++) {
        const nextRow = [];
        this.things.push(nextRow);
        for (let j = 0; j < this.width; j++) {
          nextRow.push(new Thing(i, j));
        }
      }
    }

    renderBoard() {
      const board = document.createElement('table');
      board.style = 'height: 100vh; width: 100vw;';

      for (let i = 0; i < this.height; i++) {
        const nextRow = document.createElement('tr');
        board.appendChild(nextRow);
        for (let j = 0; j < this.width; j++) {
          const nextSquare = document.createElement('td');
          nextSquare.style =
            `height: ${(1 / this.height) * 100}%;` +
            `width: ${(1 / this.width) * 100}%;` +
            'text-align: center;' +
            'border: solid black 1px';
          const nextRenderedThing = this.things[i][j].render();
          nextSquare.appendChild(nextRenderedThing);

          nextRow.appendChild(nextSquare);
        }
      }

      return board;
    }

    render() {
      const container = document.createElement('div');

      const board = this.renderBoard();
      const boardContainer = document.createElement('div');
      boardContainer.appendChild(board);

      container.appendChild(boardContainer);

      return container;
    }
  }

  class ColorSquare {
    isChanging = true;
    timeoutId = null;
    msDelay = 500;
    frequency = 0.2;
    steps = 64;
    coordinates = {};

    constructor(x, y) {
      this.coordinates.x = x;
      this.coordinates.y = y;
    }

    cycleColor() {
      // https://krazydad.com/tutorials/makecolors.php
      this.steps++;

      const red = Math.sin(this.frequency * this.steps + 0) * 127 + 128;
      const green = Math.sin(this.frequency * this.steps + 2) * 127 + 128;
      const blue = Math.sin(this.frequency * this.steps + 4) * 127 + 128;

      return `rgb(${Math.round(red)},${Math.round(green)},${Math.round(blue)})`;
    }

    handleClick(view) {
      if (this.isChanging) {
        clearTimeout(this.timeoutId);
      } else {
        this.timeoutId = setTimeout(
          this.timeoutCallback.bind(this, view),
          this.msDelay,
        );
      }
      this.isChanging = !this.isChanging;
    }

    timeoutCallback(view) {
      if (this.isChanging) {
        view.style.backgroundColor = this.cycleColor();
        this.timeoutId = setTimeout(
          this.timeoutCallback.bind(this, view),
          this.msDelay,
        );
      }
    }

    render() {
      const container = document.createElement('div');
      container.style.height = '100%';
      container.style.width = '100%';
      container.style.backgroundColor = this.cycleColor();
      container.onclick = this.handleClick.bind(this, container);
      this.timeoutId = setTimeout(
        this.timeoutCallback.bind(this, container),
        this.msDelay,
      );
      return container;
    }
  }

  const newBoard = new Board(ColorSquare, 20, 30);
  const boardView = newBoard.render();
  document.getElementById('root').appendChild(boardView);
</script>
